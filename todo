#!/usr/local/bin/python3
# Author : Nesoy

import sqlite3 as sqlite
import sys

DATABASE_NAME = "todolist.db"

def init():
    initLogo()
    conn = sqlite.connect(DATABASE_NAME)
    with conn:
        cur = conn.cursor()
        cur.execute("CREATE TABLE IF NOT EXISTS task(description TEXT, done boolean)")
def initLogo():
    print("# Todo List")

def addTodo(param):
    conn = sqlite.connect(DATABASE_NAME)	
    with conn:
        cur = conn.cursor()
        sql = "INSERT INTO task(description, done) values (?,?)"
        cur.execute(sql, [param, False])
        conn.commit()

def getTodoList():
    conn = sqlite.connect(DATABASE_NAME)
    todoList = [] # empty todolist
    with conn:
        cur = conn.cursor()
        sql = "SELECT * FROM task"
        cur.execute(sql)
        for task in cur.fetchall():
            todoList.append(task)
        
        printTodoList(todoList)

def printTodoList(todoList):
    index = 1
    for todo in todoList:
        print("[" + str(index) + "] " + todo[0] + " " + str(todo[1]))
        index += 1

def remove(desc):
    conn = sqlite.connect(DATABASE_NAME)
    with conn:
        cur = conn.cursor()
        sql = "DELETE FROM task WHERE description == (?)"
        cur.execute(sql, [desc])

def main(argv):
    init()
    if(argv[1] == "add"):
        addTodo(argv[2])
    if(argv[1] == "list"):
        getTodoList()
    if(argv[1] == "remove"):
        remove(argv[2])

if __name__ == "__main__":
        main(sys.argv)

        
